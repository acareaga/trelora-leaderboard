function fetchLeaderboard() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings/leaderboard?api_key=<%= ENV['api_key'] %>",
    success: function(leaderboard) {
      $.each(leaderboard, function(index, agent) {
        renderLeaderboard(agent)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

function fetchMostRecentRatings() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(ratings) {
      $.each(ratings, function(index, rating) {
        renderMostRecentRatings(rating)
        fetchPersonId(rating)
        fetchMemberId(rating)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

function fetchNewestRating(transactUrl) {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/transacts/"+ transactUrl +"/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(ratings) {
      $.each(ratings, function(index, rating) {
        renderNewestRating(rating)
        renderMemberName(rating)
        fetchTransactionCode(rating)
        fetchCustomerName(rating)
        fetchTransactionIdForPreviousRatings(rating)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};





function fetchTransactionIdForPreviousRatings(rating) {
  var transactId = rating.map(function(transaction){
    return (transaction.transact_id)
  })
  fetchRatingDataForPreviousTransactions(transactId[0])
};


function fetchRatingDataForPreviousTransactions(transactId) {
  $.ajax({
    type: "GET",
    url: "http://api.mytrelora.com/transacts/"+ transactId +"/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(transact) {
      a = Object.keys(transact.ratings).reduce(function(collector, key) {
        collector.push(transact.ratings[key])
        return collector;
      }, [])
      console.log(a);
      // $.each(rating, function (index, rating) {
      //   ratingCollection.push(rating)
      // })
    }
  })
};

function fetchTransactionSpecificRatingData(rating) {
  debugger;
  var transact_data = rating.map(function(transaction){
    previousTransactionRatings.push(transaction)
  })
  debugger;
  console.log(previousTransactionRatings)
};






function fetchCustomerName(rating) {
  var personId = rating.map(function(customerUrl){
    return (customerUrl.person_id)
  })
  $.ajax({
    type: "GET",
    url: "http://api.mytrelora.com/people/" + personId + "?api_key=<%= ENV['api_key'] %>",
    success: function(customer) {
      $.each(customer, function(index, customerId) {
        var customerName = customerId.name
        renderCustomerName(customerName)
    }
  )},
  })
};

function fetchTransactionCode(rating) {
  var transactId = rating.map(function(transactUrl){
    return (transactUrl.transact_id)
  })
  $.ajax({
    type: "GET",
    url: "http://api.mytrelora.com/transacts/" + transactId + "?api_key=<%= ENV['api_key'] %>",
    success: function(transaction) {
      $.each(transaction, function(index, transaction_id) {
        var code = transaction_id.code
        renderTransactionCode(code)
    }
  )},
  })
};

function fetchMemberToPage(memberPicture){
$.ajax({
  type: "GET",
  url: "http://api.mytrelora.com/members/"+ memberPicture +"?api_key=<%= ENV['api_key'] %>",
  success:function(memberPhoto){
   var photograph =  memberPhoto.member.avatar.avatar.url
   renderPhotoToPage(photograph)
  }
  })
};

function fetchMemberPhoto(collectionOfMemberIds){
  collectionOfMemberIds.map(function(member){

      return (
        $.ajax({
          type: "GET",
          url: "http://api.mytrelora.com/members/"+ member +"?api_key=<%= ENV['api_key'] %>",
          success:function(member){
            $.each(member, function (index, member) {
              memberCollection.push(member)
            })
          }
        })
      )

  });
    // setTimeout(function(){renderMembers(memberCollection)}, 1000);
};

function fetchMostRecentTransactionFromRatings() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(data) {
      $.each(data, function(index, allRatings) {
        fetchTransactionId(allRatings)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

function fetchPeople(personIdArray){
personIdArray.map(function(people){
  return (
    $.ajax({
      type: "GET",
      url: "http://api.mytrelora.com/people/"+ people +"?api_key=<%= ENV['api_key'] %>",
      success:function(people){
      $.each(people, function (index,person) {
        nameCollection.push(person)
      })
    }
    })
  )
});
  setTimeout(function(){renderNames(nameCollection)}, 1000);
};
