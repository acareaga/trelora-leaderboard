setInterval(fetchLeaderboard, 300000);

function fetchLeaderboard() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings/leaderboard?api_key=<%= ENV['api_key'] %>",
    success: function(leaderboard) {
      $.each(leaderboard, function(index, agent) {
        renderLeaderboard(agent)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

setInterval(fetchMostRecentRatings, 300000);

function fetchMostRecentRatings() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(ratings) {
      $.each(ratings, function(index, rating) {
        renderMostRecentRatings(rating)
        fetchPersonId(rating)
        fetchMemberId(rating)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

setInterval(fetchNewestRating, 300000);

function fetchNewestRating(transaction) {
  console.log(transaction)
if(transaction){

  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/transacts/"+ transaction +"/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(ratings) {
      $.each(ratings, function(index, rating) {
        renderNewestRating(rating)
        renderMemberName(rating)
        fetchTransactionCode(rating)
        fetchCustomerName(rating)
        fetchPreviousRatingsForTransactionId(rating)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  });
}
};

var previousTransactionRatings = []

setInterval(fetchPreviousRatingsForTransactionId, 300000);

function fetchPreviousRatingsForTransactionId(rating) {
  var transactId = rating.map(function(transaction){
    return (transaction.transact_id)
  })
  $.ajax({
    type: "GET",
    // " + transactId + " add where 1911
    url: "http://api.mytrelora.com/transacts/1911/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(ratings) {
      $.each(ratings, function(index, previousRatings) {
        var previousTransaction = previousRatings.id
        previousTransactionRatings.push(previousTransaction)
        // renderPreviousRatingTransactions(previousTransactionRatings)
    }
  )},
  })

};

setInterval(fetchCustomerName, 300000);

function fetchCustomerName(rating) {
  var personId = rating.map(function(customerUrl){
    return (customerUrl.person_id)
  })
  $.ajax({
    type: "GET",
    url: "http://api.mytrelora.com/people/" + personId + "?api_key=<%= ENV['api_key'] %>",
    success: function(customer) {
      $.each(customer, function(index, customerId) {
        var customerName = customerId.name
        renderCustomerName(customerName)
    }
  )},
  })
};

setInterval(fetchTransactionCode, 300000);

function fetchTransactionCode(rating) {
  var transactId = rating.map(function(transactUrl){
    return (transactUrl.transact_id)
  })
  $.ajax({
    type: "GET",
    url: "http://api.mytrelora.com/transacts/" + transactId + "?api_key=<%= ENV['api_key'] %>",
    success: function(transaction) {
      $.each(transaction, function(index, transaction_id) {
        var code = transaction_id.code
        renderTransactionCode(code)
    }
  )},
  })
};

setInterval(fetchMemberToPage, 300000);

function fetchMemberToPage(memberPicture){
$.ajax({
  type: "GET",
  url: "http://api.mytrelora.com/members/"+ memberPicture +"?api_key=<%= ENV['api_key'] %>",
  success:function(memberPhoto){
   var photograph =  memberPhoto.member.avatar.avatar.url
   renderPhotoToPage(photograph)
  }
  })
};

setInterval(fetchMemberPhoto, 300000);

function fetchMemberPhoto(collectionOfMemberIds){
  collectionOfMemberIds.map(function(member){

      return (
        $.ajax({
          type: "GET",
          url: "http://api.mytrelora.com/members/"+ member +"?api_key=<%= ENV['api_key'] %>",
          success:function(member){
            $.each(member, function (index, member) {
              memberCollection.push(member)
            })
          }
        })
      )

  });

    // setTimeout(function(){renderMembers(memberCollection)}, 1000);
};

setInterval(fetchMostRecentTransactionFromRatings, 300000);

function fetchMostRecentTransactionFromRatings() {
  $.ajax({
    type: "GET",
    url:  "http://api.mytrelora.com/ratings?api_key=<%= ENV['api_key'] %>",
    success: function(data) {
      $.each(data, function(index, allRatings) {
        fetchTransactionId(allRatings)
      }
    )},
    error: function(xhr) {
      console.log(xhr.responseText)
    }
  })
};

setInterval(fetchPeople, 300000);

function fetchPeople(personIdArray){
personIdArray.map(function(people){
  return (
    $.ajax({
      type: "GET",
      url: "http://api.mytrelora.com/people/"+ people +"?api_key=<%= ENV['api_key'] %>",
      success:function(people){
      $.each(people, function (index,person) {
        nameCollection.push(person)
      })
    }
    })
  )
});
  setTimeout(function(){renderNames(nameCollection)}, 1000);
};
